## Orthology search and paralogy pruning
[OrthoFinder](https://github.com/davidemms/OrthoFinder) was used to group the extracted coding regions into orthogroups. We used [DIAMOND](https://github.com/bbuchfink/diamond) to BLAST the proteins, [MAFFT](https://github.com/GSLBiotech/mafft) to align the orthogroups and [RAxML](https://github.com/stamatak/standard-RAxML) to infer the genetrees.

    python3 /home/saabalde/bin/OrthoFinder_source/orthofinder.py -f PROTEINS_directory -S diamond -M msa -A mafft -T raxml -t 4 -a 4

OrthoFinder assigned 229,299 genes (92.5% of the total) to 15758 orthogroups. Fifty percent of all genes were in orthogroups with 27 or more genes (G50 was 27) and were contained in the largest 1834 orthogroups (O50 was 1834). There were 2 orthogroups with all species present and 0 of these consisted entirely of single-copy genes.

Since all orthogroups are multicopy, we pruned the paralogs (homolog genes originated from duplication events) using [PhyloPyPruner](https://pypi.org/project/phylopypruner/). But first, we need to prepare the data. Instead of working with all orthogroups, we first filtered out all with fewer than four species: 7,824 orthogroups. We created a list of genes, called "00-Orthogroups.Atleastfour.txt", from the "Orthogroups.GeneCount.tsv" files generated by OrthoFinder. Using that list, we fetched the corresponding alignments and genetrees.

    mkdir -p 01-OrthoFinder_Alignments 02-Orthofinder_Gene_trees
    
    while IFS='' read -r LINE || [ -n "${LINE}" ]
        do
        cp 00-OrthoFinder_300aa_final/OrthoFinder/Results_Mar13/MultipleSequenceAlignments/${LINE}.fa ./01-OrthoFinder_Alignments/
    done < 00-Orthogroups.Atleastfour.txt 
    while IFS='' read -r LINE || [ -n "${LINE}" ]
        do
        cp 00-OrthoFinder_300aa_final/OrthoFinder/Results_Mar13/Gene_Trees/${LINE}_tree.txt ./02-Orthofinder_Gene_trees
    done < 00-Orthogroups.Atleastfour.txt 

Now, we format the files for PhyloPyPruner.

    # Alignments 
    orthofinder2phylopypruner Species.list 01-OrthoFinder_Alignments

    # Genetrees
    for i in 01-PhyloPruPruner_input/*tree.txt
        do
	    sed -i 's/19_228\_/19_228\./g' $i
        sed -i 's/19_375\_/19_375\./g' $i
        sed -i 's/19_380\_/19_380\./g' $i
        sed -i 's/20_005\_/20_005\./g' $i
        sed -i 's/20_022\_/20_022\./g' $i
        sed -i 's/20_023\_/20_023\./g' $i
        sed -i 's/20_026\_/20_026\./g' $i
        sed -i 's/20_038\_/20_038\./g' $i
        sed -i 's/20_053\_/20_053\./g' $i
        sed -i 's/20_063\_/20_063\./g' $i
        sed -i 's/20_073\_/20_073\./g' $i
        sed -i 's/20_078\_/20_078\./g' $i
        sed -i 's/20_082\_/20_082\./g' $i
        sed -i 's/20_093\_/20_093\./g' $i
        sed -i 's/20_115\_/20_115\./g' $i
        sed -i 's/20_132\_/20_132\./g' $i
        sed -i 's/DRR151142\_/DRR151142\./g' $i
        sed -i 's/P15761_101\_/P15761_101\./g' $i
        sed -i 's/P15761_102\_/P15761_102\./g' $i
        sed -i 's/P15761_110\_/P15761_110\./g' $i
        sed -i 's/P15761_117\_/P15761_117\./g' $i
        sed -i 's/P15761_125\_/P15761_125\./g' $i
        sed -i 's/P15761_133\_/P15761_133\./g' $i
        sed -i 's/P15761_141\_/P15761_141\./g' $i
        sed -i 's/P15761_149\_/P15761_149\./g' $i
        sed -i 's/P15761_157\_/P15761_157\./g' $i
        sed -i 's/P15761_165\_/P15761_165\./g' $i
        sed -i 's/P15761_173\_/P15761_173\./g' $i
        sed -i 's/P15761_181\_/P15761_181\./g' $i
        sed -i 's/P15761_189\_/P15761_189\./g' $i
        sed -i 's/SRR2500940\_/SRR2500940\./g' $i
        sed -i 's/SRR2681155\_/SRR2681155\./g' $i
        sed -i 's/SRR2681679\_/SRR2681679\./g' $i
        sed -i 's/SRR2682004\_/SRR2682004\./g' $i
        sed -i 's/SRR2682099\_/SRR2682099\./g' $i
        sed -i 's/SRR2682154\_/SRR2682154\./g' $i
        sed -i 's/SRR3105702\_/SRR3105702\./g' $i
        sed -i 's/SRR3105703\_/SRR3105703\./g' $i
        sed -i 's/SRR3105704\_/SRR3105704\./g' $i
        sed -i 's/SRR3105705\_/SRR3105705\./g' $i
        sed -i 's/SRR5760179\_/SRR5760179\./g' $i
        sed -i 's/SRR6374833\_/SRR6374833\./g' $i
        sed -i 's/SRR6375633\_/SRR6375633\./g' $i
        sed -i 's/SRR8454219\_/SRR8454219\./g' $i
        sed -i 's/SRR8506641\_/SRR8506641\./g' $i
        sed -i 's/SRR8524599\_/SRR8524599\./g' $i
        sed -i 's/SRR8617822\_/SRR8617822\./g' $i
        sed -i 's/SRR8641368\_/SRR8641368\./g' $i

        sed -i 's/\_OF\_/\.OF\@/g' $i
	
	    mv -- "$i" "${i%_tree.txt}.tre"

    done



## Now that we have the orthogroups, it is a matter of filtering out potential paralogs, contaminants, gene sets that do not represent real
## orthogroups and so on. To do so, I will apply a series of filters that aim to recover a reliable gene set. Hopefully.
## I will start by selecting all orthogroups with at least four species present. I will do that manually, sorting the table produced by
## OrthoFinder, and copying the corresponding alignments and gene trees to a new directory: 7824 orthogroups.
